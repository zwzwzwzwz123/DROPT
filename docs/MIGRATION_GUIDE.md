# DROPTæ¡†æ¶è¿ç§»æŒ‡å—ï¼šä»æ— çº¿ç½‘ç»œåˆ°æ•°æ®ä¸­å¿ƒ

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å°†DROPTæ¡†æ¶ä»æ— çº¿ç½‘ç»œåŠŸç‡åˆ†é…é—®é¢˜è¿ç§»åˆ°æ•°æ®ä¸­å¿ƒç©ºè°ƒä¼˜åŒ–é—®é¢˜ã€‚

---

## ğŸ“‹ ç›®å½•

1. [é—®é¢˜æ˜ å°„åˆ†æ](#1-é—®é¢˜æ˜ å°„åˆ†æ)
2. [ä»£ç æ”¹é€ æ¸…å•](#2-ä»£ç æ”¹é€ æ¸…å•)
3. [å®æ–½æ­¥éª¤](#3-å®æ–½æ­¥éª¤)
4. [å…³é”®è®¾è®¡å†³ç­–](#4-å…³é”®è®¾è®¡å†³ç­–)
5. [è°ƒè¯•æŒ‡å—](#5-è°ƒè¯•æŒ‡å—)
6. [æ€§èƒ½ä¼˜åŒ–](#6-æ€§èƒ½ä¼˜åŒ–)

---

## 1. é—®é¢˜æ˜ å°„åˆ†æ

### 1.1 æ ¸å¿ƒå¯¹æ¯”

| ç»´åº¦ | DROPTåŸå§‹é—®é¢˜ | æ•°æ®ä¸­å¿ƒé—®é¢˜ | æ˜ å°„ç­–ç•¥ |
|------|--------------|-------------|---------|
| **çŠ¶æ€ç©ºé—´** | 10ä¸ªä¿¡é“å¢ç›Š + å¥–åŠ± | æ¸©åº¦ã€æ¹¿åº¦ã€è´Ÿè½½ç­‰ | æ‰©å±•çŠ¶æ€ç»´åº¦ |
| **åŠ¨ä½œç©ºé—´** | 10ç»´åŠŸç‡åˆ†é… | 8ç»´ç©ºè°ƒæ§åˆ¶ï¼ˆ4Ã—2ï¼‰ | è°ƒæ•´åŠ¨ä½œç»´åº¦ |
| **çº¦æŸ** | åŠŸç‡é¢„ç®— | æ¸©åº¦èŒƒå›´ | ä¿®æ”¹çº¦æŸæ£€æŸ¥ |
| **å¥–åŠ±** | æœ€å¤§åŒ–é€Ÿç‡ | æœ€å°åŒ–èƒ½è€—+æ¸©åº¦åå·® | é‡æ–°è®¾è®¡å¥–åŠ±å‡½æ•° |
| **ä¸“å®¶** | æ°´æ³¨å…¥ç®—æ³•ï¼ˆæœ€ä¼˜ï¼‰ | PID/MPCï¼ˆæ¬¡ä¼˜ï¼‰ | æ›´æ¢ä¸“å®¶ç®—æ³• |
| **åŠ¨æ€** | ä¿¡é“éšæœºå˜åŒ– | æ¸©åº¦çƒ­åŠ›å­¦æ¼”åŒ– | æ›¿æ¢ç¯å¢ƒæ¨¡å‹ |

### 1.2 æ•°å­¦æ˜ å°„

#### DROPTåŸå§‹é—®é¢˜
```
çŠ¶æ€: s = [g_1, ..., g_10, r_{t-1}] âˆˆ R^11
åŠ¨ä½œ: a = [p_1, ..., p_10] âˆˆ [0,1]^10
çº¦æŸ: Î£p_i â‰¤ P_total
å¥–åŠ±: R = Î£log(1 + g_i*p_i) - R_optimal
```

#### æ•°æ®ä¸­å¿ƒé—®é¢˜
```
çŠ¶æ€: s = [T_in, T_out, H, Load, T_sup_1, ..., T_sup_n, r_{t-1}] âˆˆ R^(4+n+1)
åŠ¨ä½œ: a = [T_set_1, fan_1, ..., T_set_n, fan_n] âˆˆ [-1,1]^(2n)
çº¦æŸ: T_min â‰¤ T_in â‰¤ T_max
å¥–åŠ±: R = -Î±*E - Î²*(T_in - T_target)Â² - Î³*I_violation
```

---

## 2. ä»£ç æ”¹é€ æ¸…å•

### 2.1 å¿…é¡»ä¿®æ”¹çš„æ–‡ä»¶

#### â­â­â­â­â­ æ ¸å¿ƒç¯å¢ƒæ–‡ä»¶

**`env/datacenter_env.py`** (æ–°å»º)
- **ä½œç”¨**: æ›¿æ¢åŸå§‹AIGCç¯å¢ƒ
- **å…³é”®ä¿®æ”¹**:
  - çŠ¶æ€ç©ºé—´å®šä¹‰ï¼ˆæ¸©åº¦ã€æ¹¿åº¦ã€è´Ÿè½½ï¼‰
  - åŠ¨ä½œç©ºé—´å®šä¹‰ï¼ˆæ¸©åº¦è®¾å®šã€é£é€Ÿï¼‰
  - å¥–åŠ±å‡½æ•°ï¼ˆèƒ½è€—+æ¸©åº¦åå·®ï¼‰
  - ç¯å¢ƒåŠ¨æ€ï¼ˆçƒ­åŠ›å­¦æ¨¡å‹ï¼‰
- **ä»£ç é‡**: ~400è¡Œ

**`env/thermal_model.py`** (æ–°å»º)
- **ä½œç”¨**: æ¨¡æ‹Ÿæ•°æ®ä¸­å¿ƒçƒ­åŠ›å­¦è¡Œä¸º
- **å…³é”®å†…å®¹**:
  - çƒ­å¹³è¡¡æ–¹ç¨‹
  - CRACåˆ¶å†·æ¨¡å‹
  - COPæ•ˆç‡æ¨¡å‹
- **ä»£ç é‡**: ~300è¡Œ

**`env/expert_controller.py`** (æ–°å»º)
- **ä½œç”¨**: æä¾›ä¸“å®¶åŠ¨ä½œï¼ˆæ›¿ä»£æ°´æ³¨å…¥ç®—æ³•ï¼‰
- **å…³é”®å†…å®¹**:
  - PIDæ§åˆ¶å™¨
  - MPCæ§åˆ¶å™¨
  - åŸºäºè§„åˆ™çš„æ§åˆ¶å™¨
- **ä»£ç é‡**: ~300è¡Œ

#### â­â­â­ è®­ç»ƒä¸»ç¨‹åº

**`main_datacenter.py`** (æ–°å»º)
- **ä½œç”¨**: æ•°æ®ä¸­å¿ƒè®­ç»ƒå…¥å£
- **ä¿®æ”¹å†…å®¹**:
  - å¯¼å…¥æ•°æ®ä¸­å¿ƒç¯å¢ƒ
  - è°ƒæ•´è¶…å‚æ•°é»˜è®¤å€¼
  - ä¿®æ”¹çŠ¶æ€/åŠ¨ä½œç»´åº¦è·å–
- **ä»£ç é‡**: ~250è¡Œ
- **å¤ç”¨**: 80%ä»£ç ä¸`main.py`ç›¸åŒ

### 2.2 å¯é€‰ä¿®æ”¹çš„æ–‡ä»¶

#### â­â­ ç½‘ç»œæ¶æ„

**`diffusion/model.py`**
- **æ˜¯å¦ä¿®æ”¹**: å¯é€‰
- **ä¿®æ”¹åŸå› **: 
  - çŠ¶æ€/åŠ¨ä½œç»´åº¦å˜åŒ–
  - å¯èƒ½éœ€è¦æ›´æ·±çš„ç½‘ç»œ
- **ä¿®æ”¹æ–¹æ³•**:
```python
# åŸå§‹: å›ºå®šéšè—å±‚
hidden_sizes = [256, 256]

# ä¿®æ”¹: å¯é…ç½®éšè—å±‚
hidden_sizes = args.hidden_sizes  # [256, 256, 256]
```

#### â­ ç­–ç•¥ç±»

**`policy/diffusion_opt.py`**
- **æ˜¯å¦ä¿®æ”¹**: é€šå¸¸ä¸éœ€è¦
- **å¯èƒ½ä¿®æ”¹**: 
  - å¥–åŠ±å½’ä¸€åŒ–ç­–ç•¥
  - æ¢ç´¢å™ªå£°è°ƒæ•´
- **ä¿®æ”¹ä½ç½®**: `forward()`æ–¹æ³•ä¸­çš„æ¢ç´¢ç­–ç•¥

### 2.3 æ— éœ€ä¿®æ”¹çš„æ–‡ä»¶

âœ… **`diffusion/diffusion.py`** - æ‰©æ•£æ¨¡å‹æ ¸å¿ƒç®—æ³•
âœ… **`diffusion/helpers.py`** - è¾…åŠ©å‡½æ•°
âœ… **`diffusion/utils.py`** - å·¥å…·å‡½æ•°
âœ… **`policy/helpers.py`** - ç­–ç•¥è¾…åŠ©å‡½æ•°

---

## 3. å®æ–½æ­¥éª¤

### é˜¶æ®µ1: ç¯å¢ƒæ­å»ºï¼ˆç¬¬1-2å¤©ï¼‰

#### Step 1.1: åˆ›å»ºåŸºç¡€ç¯å¢ƒç±»

```bash
# åˆ›å»ºæ–‡ä»¶
touch env/datacenter_env.py

# å®ç°åŸºç¡€æ¡†æ¶
# - __init__(): å®šä¹‰çŠ¶æ€/åŠ¨ä½œç©ºé—´
# - reset(): åˆå§‹åŒ–ç¯å¢ƒ
# - step(): æ‰§è¡Œä¸€æ­¥ä»¿çœŸï¼ˆå…ˆç”¨ç®€åŒ–æ¨¡å‹ï¼‰
# - _compute_reward(): è®¡ç®—å¥–åŠ±
```

**éªŒè¯**:
```python
from env.datacenter_env import DataCenterEnv
env = DataCenterEnv()
state = env.reset()
action = env.action_space.sample()
next_state, reward, done, info = env.step(action)
print(f"State shape: {state.shape}")
print(f"Reward: {reward}")
```

#### Step 1.2: å®ç°ç®€åŒ–çƒ­åŠ›å­¦æ¨¡å‹

```bash
# å…ˆå®ç°SimplifiedThermalModel
# ä½¿ç”¨ä¸€é˜¶æƒ¯æ€§ç¯èŠ‚å¿«é€ŸåŸå‹
```

**éªŒè¯**:
```python
from env.thermal_model import SimplifiedThermalModel
model = SimplifiedThermalModel()
T_next, H_next, T_sup, energy = model.step(...)
print(f"Temperature change: {T_next - T_in}")
```

#### Step 1.3: å®ç°åŸºç¡€ä¸“å®¶æ§åˆ¶å™¨

```bash
# å…ˆå®ç°RuleBasedController
# ç®€å•çš„if-elseè§„åˆ™
```

**éªŒè¯**:
```python
from env.expert_controller import RuleBasedController
controller = RuleBasedController()
action = controller.get_action(T_in=26.0, ...)
print(f"Expert action: {action}")
```

### é˜¶æ®µ2: é›†æˆæµ‹è¯•ï¼ˆç¬¬3å¤©ï¼‰

#### Step 2.1: è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
python scripts/test_datacenter_env.py
```

**é¢„æœŸè¾“å‡º**:
```
âœ“ ç¯å¢ƒåŸºæœ¬åŠŸèƒ½æµ‹è¯•é€šè¿‡
âœ“ ä¸“å®¶æ§åˆ¶å™¨æµ‹è¯•é€šè¿‡
âœ“ çƒ­åŠ›å­¦æ¨¡å‹æµ‹è¯•é€šè¿‡
âœ“ å‘é‡åŒ–ç¯å¢ƒæµ‹è¯•é€šè¿‡
âœ“ é›†æˆæµ‹è¯•é€šè¿‡
```

#### Step 2.2: ä¿®å¤é—®é¢˜

å¸¸è§é—®é¢˜ï¼š
1. **çŠ¶æ€ç»´åº¦ä¸åŒ¹é…**: æ£€æŸ¥`observation_space`å®šä¹‰
2. **åŠ¨ä½œèŒƒå›´é”™è¯¯**: æ£€æŸ¥`_denormalize_action()`
3. **å¥–åŠ±å¼‚å¸¸**: æ£€æŸ¥å¥–åŠ±å‡½æ•°æƒé‡
4. **æ¸©åº¦å‘æ•£**: æ£€æŸ¥çƒ­åŠ›å­¦æ¨¡å‹å‚æ•°

### é˜¶æ®µ3: å¿«é€Ÿè®­ç»ƒéªŒè¯ï¼ˆç¬¬4å¤©ï¼‰

#### Step 3.1: è¡Œä¸ºå…‹éš†å¿«é€Ÿè®­ç»ƒ

```bash
# çŸ­æ—¶é—´è®­ç»ƒéªŒè¯æµç¨‹
python main_datacenter.py \
    --bc-coef \
    --expert-type rule_based \
    --epoch 1000 \
    --batch-size 128 \
    --n-timesteps 3 \
    --episode-length 50
```

**æ£€æŸ¥ç‚¹**:
- [ ] è®­ç»ƒèƒ½æ­£å¸¸å¯åŠ¨
- [ ] æŸå¤±ä¸‹é™
- [ ] TensorBoardæœ‰æ•°æ®
- [ ] æ— æŠ¥é”™

#### Step 3.2: è§‚å¯Ÿæ¨¡å¼æµ‹è¯•

```bash
python main_datacenter.py \
    --watch \
    --resume-path log_datacenter/.../policy_best.pth
```

**æ£€æŸ¥ç‚¹**:
- [ ] æ¨¡å‹èƒ½åŠ è½½
- [ ] èƒ½ç”ŸæˆåŠ¨ä½œ
- [ ] æ¸©åº¦åœ¨åˆç†èŒƒå›´

### é˜¶æ®µ4: å®Œæ•´è®­ç»ƒï¼ˆç¬¬5-7å¤©ï¼‰

#### Step 4.1: å®ç°å®Œæ•´çƒ­åŠ›å­¦æ¨¡å‹

```bash
# å®ç°ThermalModelï¼ˆç‰©ç†æ¨¡å‹ï¼‰
# åŒ…å«è¯¦ç»†çš„èƒ½é‡å®ˆæ’å’ŒCOPè®¡ç®—
```

#### Step 4.2: å®ç°PID/MPCæ§åˆ¶å™¨

```bash
# å®ç°æ›´å¥½çš„ä¸“å®¶æ§åˆ¶å™¨
```

#### Step 4.3: å®Œæ•´è®­ç»ƒ

```bash
# è¡Œä¸ºå…‹éš†è®­ç»ƒ
python main_datacenter.py \
    --bc-coef \
    --expert-type pid \
    --epoch 50000 \
    --batch-size 256

# ç­–ç•¥æ¢¯åº¦è®­ç»ƒ
python main_datacenter.py \
    --epoch 200000 \
    --batch-size 512 \
    --n-timesteps 8
```

### é˜¶æ®µ5: ä¼˜åŒ–è°ƒå‚ï¼ˆç¬¬8-10å¤©ï¼‰

#### Step 5.1: è¶…å‚æ•°æœç´¢

```bash
# å°è¯•ä¸åŒé…ç½®
for lr in 1e-4 3e-4 1e-3; do
    for timesteps in 5 6 8; do
        python main_datacenter.py \
            --actor-lr $lr \
            --n-timesteps $timesteps \
            --logdir log_search
    done
done
```

#### Step 5.2: å¥–åŠ±å‡½æ•°è°ƒä¼˜

```bash
# è°ƒæ•´æƒé‡
python main_datacenter.py \
    --energy-weight 1.0 \
    --temp-weight 10.0 \
    --violation-penalty 100.0
```

---

## 4. å…³é”®è®¾è®¡å†³ç­–

### 4.1 çŠ¶æ€ç©ºé—´è®¾è®¡

**å†³ç­–**: åŒ…å«å“ªäº›çŠ¶æ€å˜é‡ï¼Ÿ

**é€‰é¡¹**:
1. **æœ€å°çŠ¶æ€** (æ¨èæ–°æ‰‹):
   - T_in, T_out, IT_load, reward_last
   - ä¼˜ç‚¹: ç®€å•ï¼Œè®­ç»ƒå¿«
   - ç¼ºç‚¹: ä¿¡æ¯ä¸è¶³

2. **æ ‡å‡†çŠ¶æ€** (æ¨è):
   - T_in, T_out, H_in, IT_load, T_supply_1...n, reward_last
   - ä¼˜ç‚¹: å¹³è¡¡æ€§èƒ½å’Œå¤æ‚åº¦
   - ç¼ºç‚¹: æ— 

3. **æ‰©å±•çŠ¶æ€**:
   - åŠ å…¥å†å²ä¿¡æ¯ã€é¢„æµ‹ä¿¡æ¯
   - ä¼˜ç‚¹: æ€§èƒ½æœ€å¥½
   - ç¼ºç‚¹: è®­ç»ƒæ…¢ï¼Œå®¹æ˜“è¿‡æ‹Ÿåˆ

**å»ºè®®**: ä»æ ‡å‡†çŠ¶æ€å¼€å§‹

### 4.2 åŠ¨ä½œç©ºé—´è®¾è®¡

**å†³ç­–**: æ§åˆ¶ä»€ä¹ˆï¼Ÿ

**é€‰é¡¹**:
1. **ä»…æ¸©åº¦è®¾å®š**:
   - åŠ¨ä½œ: [T_set_1, ..., T_set_n]
   - ä¼˜ç‚¹: ç®€å•
   - ç¼ºç‚¹: æ§åˆ¶ä¸å¤Ÿç²¾ç»†

2. **æ¸©åº¦+é£é€Ÿ** (æ¨è):
   - åŠ¨ä½œ: [T_set_1, fan_1, ..., T_set_n, fan_n]
   - ä¼˜ç‚¹: æ§åˆ¶ç²¾ç»†ï¼ŒèŠ‚èƒ½æ•ˆæœå¥½
   - ç¼ºç‚¹: åŠ¨ä½œç»´åº¦é«˜

3. **å®Œå…¨æ§åˆ¶**:
   - åŠ å…¥å‹ç¼©æœºé¢‘ç‡ã€é˜€é—¨å¼€åº¦ç­‰
   - ä¼˜ç‚¹: æœ€ç²¾ç»†
   - ç¼ºç‚¹: è¿‡äºå¤æ‚

**å»ºè®®**: æ¸©åº¦+é£é€Ÿ

### 4.3 å¥–åŠ±å‡½æ•°è®¾è®¡

**å†³ç­–**: å¦‚ä½•å¹³è¡¡èƒ½è€—å’Œæ¸©åº¦ï¼Ÿ

**å…¬å¼**:
```
R = -Î±*E - Î²*(T - T_target)Â² - Î³*I_violation
```

**æƒé‡å»ºè®®**:
- **ä¿å®ˆå‹** (ä¼˜å…ˆæ¸©åº¦ç¨³å®š):
  - Î±=0.5, Î²=20.0, Î³=200.0
  
- **å¹³è¡¡å‹** (æ¨è):
  - Î±=1.0, Î²=10.0, Î³=100.0
  
- **æ¿€è¿›å‹** (ä¼˜å…ˆèŠ‚èƒ½):
  - Î±=2.0, Î²=5.0, Î³=50.0

**è°ƒæ•´ç­–ç•¥**:
1. å…ˆç”¨ä¿å®ˆå‹ç¡®ä¿æ¸©åº¦ç¨³å®š
2. é€æ­¥å¢åŠ Î±é™ä½èƒ½è€—
3. æ ¹æ®å®é™…éœ€æ±‚å¾®è°ƒ

### 4.4 è®­ç»ƒæ¨¡å¼é€‰æ‹©

**å†³ç­–**: BCè¿˜æ˜¯PGï¼Ÿ

**å†³ç­–æ ‘**:
```
æ˜¯å¦æœ‰å¯ç”¨çš„ä¸“å®¶æ§åˆ¶å™¨ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ˜¯å¦è¿½æ±‚è¶…è¶Šä¸“å®¶ï¼Ÿ
â”‚   â”œâ”€ æ˜¯ â†’ æ··åˆè®­ç»ƒï¼ˆBCé¢„è®­ç»ƒ + PGå¾®è°ƒï¼‰
â”‚   â””â”€ å¦ â†’ çº¯BCè®­ç»ƒ
â””â”€ å¦ â†’ çº¯PGè®­ç»ƒï¼ˆéœ€è¦æ›´å¤šæ—¶é—´ï¼‰
```

**æ¨è**:
- **æ–°æ‰‹**: BCè®­ç»ƒï¼ˆå¿«é€Ÿè§æ•ˆï¼‰
- **è¿›é˜¶**: æ··åˆè®­ç»ƒï¼ˆæœ€ä½³æ€§èƒ½ï¼‰
- **ç ”ç©¶**: PGè®­ç»ƒï¼ˆæ¢ç´¢æé™ï¼‰

---

## 5. è°ƒè¯•æŒ‡å—

### 5.1 å¸¸è§é”™è¯¯åŠè§£å†³

#### é”™è¯¯1: çŠ¶æ€ç»´åº¦ä¸åŒ¹é…

**ç—‡çŠ¶**:
```
RuntimeError: Expected tensor of size [batch, 11] but got [batch, 9]
```

**åŸå› **: ç¯å¢ƒçŠ¶æ€ç»´åº¦ä¸ç½‘ç»œè¾“å…¥ä¸åŒ¹é…

**è§£å†³**:
```python
# æ£€æŸ¥ç¯å¢ƒ
print(f"Env state dim: {env.observation_space.shape[0]}")

# æ£€æŸ¥ç½‘ç»œ
print(f"Network input dim: {actor.state_dim}")

# ç¡®ä¿ä¸€è‡´
args.state_shape = env.observation_space.shape[0]
```

#### é”™è¯¯2: åŠ¨ä½œè¶…å‡ºèŒƒå›´

**ç—‡çŠ¶**:
```
AssertionError: Action out of bounds
```

**åŸå› **: åŠ¨ä½œå½’ä¸€åŒ–/åå½’ä¸€åŒ–é”™è¯¯

**è§£å†³**:
```python
# æ£€æŸ¥åŠ¨ä½œèŒƒå›´
action = policy.forward(state).act
print(f"Action range: [{action.min()}, {action.max()}]")

# ç¡®ä¿è£å‰ª
action = np.clip(action, -1.0, 1.0)
```

#### é”™è¯¯3: å¥–åŠ±å¼‚å¸¸

**ç—‡çŠ¶**:
```
Reward: -inf æˆ– nan
```

**åŸå› **: å¥–åŠ±è®¡ç®—ä¸­æœ‰é™¤é›¶æˆ–log(0)

**è§£å†³**:
```python
# æ·»åŠ æ•°å€¼ç¨³å®šæ€§
energy_penalty = self.alpha * energy / (100.0 + 1e-6)
temp_penalty = self.beta * np.clip(temp_deviation**2, 0, 100)
```

#### é”™è¯¯4: è®­ç»ƒä¸æ”¶æ•›

**ç—‡çŠ¶**: æŸå¤±ä¸ä¸‹é™æˆ–éœ‡è¡

**è¯Šæ–­**:
```python
# æ£€æŸ¥æ¢¯åº¦
for name, param in actor.named_parameters():
    if param.grad is not None:
        print(f"{name}: grad_norm={param.grad.norm()}")
```

**è§£å†³**:
1. é™ä½å­¦ä¹ ç‡: `--actor-lr 1e-4`
2. å¢åŠ æ‰¹æ¬¡: `--batch-size 512`
3. æ¢¯åº¦è£å‰ª: åœ¨`policy/diffusion_opt.py`ä¸­æ·»åŠ 
```python
torch.nn.utils.clip_grad_norm_(actor.parameters(), max_norm=1.0)
```

### 5.2 è°ƒè¯•å·¥å…·

#### å·¥å…·1: ç¯å¢ƒå¯è§†åŒ–

```python
# åœ¨env/datacenter_env.pyä¸­æ·»åŠ 
def render(self, mode='human'):
    import matplotlib.pyplot as plt
    plt.plot(self.temp_history)
    plt.show()
```

#### å·¥å…·2: æ—¥å¿—å¢å¼º

```python
# åœ¨main_datacenter.pyä¸­æ·»åŠ 
def log_callback(epoch, env_step, **kwargs):
    print(f"Epoch {epoch}: step={env_step}")
    # è®°å½•æ›´å¤šä¿¡æ¯
```

#### å·¥å…·3: æ–­ç‚¹è°ƒè¯•

```python
# åœ¨å…³é”®ä½ç½®æ·»åŠ 
import pdb; pdb.set_trace()

# æˆ–ä½¿ç”¨IPython
from IPython import embed; embed()
```

---

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 è®­ç»ƒé€Ÿåº¦ä¼˜åŒ–

#### ä¼˜åŒ–1: å¹¶è¡Œç¯å¢ƒ

```bash
# å¢åŠ å¹¶è¡Œç¯å¢ƒæ•°
python main_datacenter.py --training-num 16
```

**æ•ˆæœ**: è®­ç»ƒé€Ÿåº¦æå‡2-4å€

#### ä¼˜åŒ–2: å‡å°‘æ‰©æ•£æ­¥æ•°

```bash
# è®­ç»ƒæ—¶ç”¨å°‘æ­¥æ•°
python main_datacenter.py --n-timesteps 3

# æ¨ç†æ—¶ç”¨å¤šæ­¥æ•°
python main_datacenter.py --watch --n-timesteps 8
```

**æ•ˆæœ**: è®­ç»ƒé€Ÿåº¦æå‡2å€ï¼Œæ€§èƒ½ç•¥é™

#### ä¼˜åŒ–3: æ··åˆç²¾åº¦è®­ç»ƒ

```python
# åœ¨main_datacenter.pyä¸­æ·»åŠ 
from torch.cuda.amp import autocast, GradScaler
scaler = GradScaler()

# åœ¨è®­ç»ƒå¾ªç¯ä¸­
with autocast():
    loss = policy.learn(batch)
scaler.scale(loss).backward()
```

**æ•ˆæœ**: è®­ç»ƒé€Ÿåº¦æå‡30-50%

### 6.2 æ€§èƒ½ä¼˜åŒ–

#### ä¼˜åŒ–1: è¯¾ç¨‹å­¦ä¹ 

```python
# é€æ­¥å¢åŠ éš¾åº¦
# é˜¶æ®µ1: å›ºå®šè´Ÿè½½
env = DataCenterEnv(IT_load_fixed=200.0)

# é˜¶æ®µ2: å°èŒƒå›´å˜åŒ–
env = DataCenterEnv(IT_load_range=(180, 220))

# é˜¶æ®µ3: å®Œæ•´èŒƒå›´
env = DataCenterEnv(IT_load_range=(100, 500))
```

#### ä¼˜åŒ–2: å¥–åŠ±å¡‘å½¢

```python
# æ·»åŠ ä¸­é—´å¥–åŠ±
reward += 0.1 * (1.0 - abs(temp_deviation) / tolerance)  # æ¥è¿‘ç›®æ ‡å¥–åŠ±
reward += 0.05 * (1.0 - fan_speed.mean())  # ä½é£é€Ÿå¥–åŠ±
```

#### ä¼˜åŒ–3: ç»éªŒå›æ”¾ä¼˜åŒ–

```bash
# ä½¿ç”¨ä¼˜å…ˆç»éªŒå›æ”¾
python main_datacenter.py \
    --prioritized-replay \
    --prior-alpha 0.6 \
    --prior-beta 0.4
```

---

## 7. æ£€æŸ¥æ¸…å•

### å¼€å‘å®Œæˆæ£€æŸ¥

- [ ] ç¯å¢ƒèƒ½æ­£å¸¸resetå’Œstep
- [ ] çŠ¶æ€/åŠ¨ä½œç»´åº¦æ­£ç¡®
- [ ] å¥–åŠ±å‡½æ•°åˆç†
- [ ] ä¸“å®¶æ§åˆ¶å™¨èƒ½å·¥ä½œ
- [ ] çƒ­åŠ›å­¦æ¨¡å‹ç‰©ç†åˆç†
- [ ] æµ‹è¯•è„šæœ¬å…¨éƒ¨é€šè¿‡
- [ ] èƒ½å®ŒæˆçŸ­æ—¶é—´è®­ç»ƒ
- [ ] TensorBoardèƒ½æ˜¾ç¤ºæ›²çº¿

### è®­ç»ƒå®Œæˆæ£€æŸ¥

- [ ] æŸå¤±æ”¶æ•›
- [ ] å¥–åŠ±ä¸Šå‡
- [ ] æ¸©åº¦è¶Šç•Œç‡ < 5%
- [ ] èƒ½è€—æœ‰ä¸‹é™
- [ ] æ¨¡å‹èƒ½ä¿å­˜å’ŒåŠ è½½
- [ ] è§‚å¯Ÿæ¨¡å¼èƒ½è¿è¡Œ
- [ ] æ€§èƒ½ä¼˜äºbaseline

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] åœ¨å¤šä¸ªéšæœºç§å­ä¸‹ç¨³å®š
- [ ] åœ¨ä¸åŒå­£èŠ‚/è´Ÿè½½ä¸‹é²æ£’
- [ ] å“åº”é€Ÿåº¦æ»¡è¶³è¦æ±‚
- [ ] æœ‰å®Œæ•´çš„æ—¥å¿—å’Œç›‘æ§
- [ ] æœ‰å¼‚å¸¸å¤„ç†æœºåˆ¶
- [ ] æœ‰å›é€€åˆ°ä¸“å®¶çš„æœºåˆ¶

---

## 8. æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **ç¯å¢ƒæ˜¯å…³é”®**: 80%çš„å·¥ä½œåœ¨ç¯å¢ƒå®ç°
2. **å…ˆç®€å•åå¤æ‚**: ä»ç®€åŒ–æ¨¡å‹å¼€å§‹
3. **å……åˆ†æµ‹è¯•**: æ¯ä¸ªç»„ä»¶å•ç‹¬æµ‹è¯•
4. **BCå…ˆè¡Œ**: å…ˆç”¨BCéªŒè¯æµç¨‹
5. **é€æ­¥ä¼˜åŒ–**: ä¸è¦ä¸€æ¬¡æ”¹å¤ªå¤š

### æ—¶é—´ä¼°ç®—

- **æœ€å°å¯è¡Œç‰ˆæœ¬**: 3-5å¤©
- **å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬**: 7-10å¤©
- **ä¼˜åŒ–è°ƒå‚ç‰ˆæœ¬**: 10-14å¤©

### ä¸‹ä¸€æ­¥

å®Œæˆè¿ç§»åï¼Œå¯ä»¥æ¢ç´¢ï¼š
1. å¤šç›®æ ‡ä¼˜åŒ–ï¼ˆèƒ½è€—+å¯¿å‘½+èˆ’é€‚åº¦ï¼‰
2. åˆ†å¸ƒå¼æ•°æ®ä¸­å¿ƒååŒæ§åˆ¶
3. ä¸çœŸå®ç³»ç»Ÿé›†æˆ
4. åœ¨çº¿å­¦ä¹ å’Œé€‚åº”

---

**ç¥è¿ç§»é¡ºåˆ©ï¼** ğŸš€

